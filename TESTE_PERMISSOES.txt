===== TESTE DE PERMISSOES - SISTEMA DE CLANS =====

PROBLEMA IDENTIFICADO:
- Jogadores novos que escolhem clan via menu nao conseguem minerar, colocar blocos ou atacar
- Tentativa de dar OP via script foi REMOVIDA (nao funciona)
- Solucao: garantir que default-player-permission-level=member funcione

MUDANCAS FEITAS:
1. Removida tentativa de dar OP automaticamente (nao funciona)
2. Adicionados logs de debug para rastrear ataques
3. Melhorada deteccao de friendly fire

COMO TESTAR:
=============

1. PARAR O SERVIDOR
   - Feche o servidor se estiver rodando

2. VERIFICAR server.properties
   - Confirme que tem: default-player-permission-level=member
   - Ja esta correto no seu arquivo

3. LIMPAR JOGADORES PROBLEMATICOS (OPCIONAL)
   - Se quiser resetar os jogadores com problema, use no console:
   tag @a[name="IdleNormal81046"] remove clan_yellow
   tag @a[name="SixNevada63735"] remove clan_blue
   
4. INICIAR SERVIDOR
   - Inicie o servidor normalmente

5. TESTE COM JOGADOR NOVO
   a) Conecte um jogador que NUNCA entrou antes
   b) Escolha um clan no menu
   c) TESTE IMEDIATAMENTE (sem reconectar):
      - Tente minerar um bloco
      - Tente colocar um bloco
      - Tente atacar um mob
   
   d) Se NAO funcionar:
      - Desconecte e reconecte
      - Teste novamente
   
6. TESTE FRIENDLY FIRE
   a) Conecte 2 jogadores do MESMO clan
   b) Um tenta atacar o outro
   c) Deve aparecer: "Voce nao pode atacar membros do seu cla!"
   d) Nenhum dano deve ser causado
   
   e) Conecte 2 jogadores de CLANS DIFERENTES
   f) Um tenta atacar o outro
   g) Dano DEVE ser causado normalmente

7. VERIFICAR LOGS NO CONSOLE
   - Procure por mensagens [CLANS] no console
   - Logs importantes:
     * "[CLANS] Hit: NomeAtacante -> NomeVitima"
     * "[CLANS] Damage: NomeAtacante -> NomeVitima"
     * "[CLANS] Blocked friendly fire: ..." (se bloqueou)
     * "[CLANS] Allowed damage: ..." (se permitiu)

8. VERIFICAR TAGS
   - No console do servidor, digite:
   tag @a list
   - Cada jogador deve ter UMA tag de clan (clan_red, clan_blue, etc)

SOLUCOES SE AINDA NAO FUNCIONAR:
=================================

PROBLEMA: Jogadores nao conseguem minerar/colocar blocos
SOLUCAO 1: Dar permissao manualmente no console
   permission set <nome_jogador> member

SOLUCAO 2: Adicionar jogador como operator temporariamente
   op <nome_jogador>
   (depois remover com: deop <nome_jogador>)

SOLUCAO 3: Verificar se o mundo foi criado corretamente
   - O mundo DEVE ter sido criado no cliente Minecraft
   - Com experimento "Beta APIs" ATIVADO
   - Depois copiado para a pasta worlds/ do servidor

PROBLEMA: Friendly fire nao funciona
SOLUCAO: Verificar os logs [CLANS] no console
   - Se aparecer "Hit:" mas nao aparecer "Damage:", o evento beforeEvents.entityHurt nao esta funcionando
   - Isso pode indicar problema com a versao do servidor ou experimentos

===== FIM =====
